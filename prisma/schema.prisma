generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model UploadSession {
  id              String         @id @default(cuid())
  user_id         String
  filename        String
  file_size       Int?
  totalCodes      Int?           @default(0) @map("total_codes")
  processed_codes Int?           @default(0)
  status          String?        @default("processing")
  createdAt       DateTime?      @default(now()) @map("created_at")
  updated_at      DateTime?      @default(now())
  codes           Code[]
  send_history    send_history[]
  users           users          @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_upload_sessions_user_id")
  @@map("upload_sessions")
}

model Code {
  id           String        @id @default(cuid())
  sessionId    String        @map("session_id")
  columnAValue String?       @map("column_a_value")
  columnDValue String?       @map("column_d_value")
  combinedCode String        @map("combined_code")
  rowNumber    Int           @map("row_number")
  status       String?       @default("available")
  sentAt       DateTime?     @map("sent_at")
  archivedAt   DateTime?     @map("archived_at")
  createdAt    DateTime?     @default(now()) @map("created_at")
  session      UploadSession @relation(fields: [sessionId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([sessionId], map: "idx_codes_session_id")
  @@index([status], map: "idx_codes_status")
  @@map("codes")
}

model ApiSetting {
  id          String    @id @default(cuid())
  user_id     String
  serviceType String    @map("service_type")
  config_data Json
  isActive    Boolean?  @default(true) @map("is_active")
  createdAt   DateTime? @default(now()) @map("created_at")
  updatedAt   DateTime? @default(now()) @updatedAt @map("updated_at")
  users       users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, serviceType])
  @@index([user_id, serviceType], map: "idx_api_settings_user_service")
  @@map("api_settings")
}

model send_history {
  id              String         @id @default(cuid())
  user_id         String
  session_id      String?
  action_type     String
  destination     String?
  codes_count     Int?           @default(0)
  status          String?        @default("pending")
  error_message   String?
  created_at      DateTime?      @default(now())
  upload_sessions UploadSession? @relation(fields: [session_id], references: [id], onUpdate: NoAction)
  users           users          @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_send_history_user_id")
}

model users {
  id              String          @id @default(cuid())
  email           String          @unique
  password_hash   String
  name            String
  created_at      DateTime?       @default(now())
  updated_at      DateTime?       @default(now())
  api_settings    ApiSetting[]
  send_history    send_history[]
  upload_sessions UploadSession[]
}
